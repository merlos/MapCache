<!DOCTYPE html>
<html lang="en">
  <head>
    <title>MapCache  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="MapCache  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">MapCache Docs</a> (58% documented)</p>
        <p class="header-right"><a href="https://github.com/merlos/MapCache"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">MapCache Reference</a>
        <img id="carat" src="img/carat.png" />
        MapCache  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/CachedTileOverlay.html">CachedTileOverlay</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/DiskCache.html">DiskCache</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/HashBase.html">HashBase</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MD5.html">MD5</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/MapCache.html">MapCache</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/RegionDownloader.html">RegionDownloader</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/TileCoords.html">TileCoords</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/TileCoordsRegion.html">TileCoordsRegion</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/LatitudeError.html">LatitudeError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/LongitudeError.html">LongitudeError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TileError.html">TileError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/TileRangeError.html">TileRangeError</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/ZoomError.html">ZoomError</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/FileManager.html">FileManager</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int.html">Int</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/MKMapView.html">MKMapView</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/MKTileOverlayPath.html">MKTileOverlayPath</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/NSMutableData.html">NSMutableData</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/String.html">String</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Functions.html">Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Functions.html#/s:8MapCache1loiySbSo8NSNumberC_ADtF">&lt;(_:_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8MapCache12arrayOfBytes5value6lengthSays5UInt8VGx_SiSgtlF">arrayOfBytes(value:length:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8MapCache17isNoSuchFileError33_FC193A7AE40E49CC84DE49A3128B2975LLySbs0G0_pSgF">isNoSuchFileError(_:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8MapCache10rotateLeft1v1ns6UInt32VAF_AFtF">rotateLeft(v:n:)</a>
              </li>
              <li class="nav-group-task">
                <a href="Functions.html#/s:8MapCache18sliceToUInt32ArrayySays0E0VGs0F5SliceVys5UInt8VGF">sliceToUInt32Array(_:)</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/MapCacheProtocol.html">MapCacheProtocol</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RegionDownloaderDelegate.html">RegionDownloaderDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/BytesSequence.html">BytesSequence</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Log.html">Log</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Log/Level.html">– Level</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/MapCacheConfig.html">MapCacheConfig</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TileRange.html">TileRange</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/TileRangeIterator.html">TileRangeIterator</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ZoomRange.html">ZoomRange</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/ZoomRangeIterator.html">ZoomRangeIterator</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:8MapCache10TileNumbera">TileNumber</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:8MapCache4Zooma">Zoom</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='mapcache-swift' class='heading'>MapCache Swift</h1>

<p><div style="text-align:center"><img src="./images/MapCache.png"></div>
</p>

<p><a href="https://travis-ci.org/merlos/MapCache"><img src="https://travis-ci.com/merlos/MapCache.svg?branch=master" alt="CI Status"></a>
<a href="https://cocoapods.org/pods/MapCache"><img src="https://img.shields.io/cocoapods/v/MapCache.svg?style=flat" alt="Version"></a>
<a href="https://cocoapods.org/pods/MapCache"><img src="https://img.shields.io/cocoapods/l/MapCache.svg?style=flat" alt="License"></a>
<a href="https://cocoapods.org/pods/MapCache"><img src="https://img.shields.io/cocoapods/p/MapCache.svg?style=flat" alt="Platform"></a></p>

<p>The missing part of <a href="https://developer.apple.com/documentation/mapkit">MapKit</a>: A simple way to cache <a href="https://en.wikipedia.org/wiki/Tiled_web_map">map tiles</a> and support offline browsing of maps.</p>

<p>Current features: </p>

<ul>
<li>Automatically save tiles in a disk cache as user browses the map.</li>
<li>You can to set cache capacity. Once the cache is full it will use a LRU (Least recently Used) algorithm.</li>
<li>Get Current cache size</li>
<li>Clear existing cache</li>
</ul>

<p>What is coming:</p>

<ul>
<li>Download a full region of the map.</li>
<li>Smart predownloading/caching: anticipate tiles that may be needed during network idle</li>
<li>Background cache updates downloads</li>
<li>Improve documentation</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>

<p>MapCache is available through <a href="https://cocoapods.org">CocoaPods</a>. To install
it, simply add the following line to your Podfile:</p>
<pre class="highlight ruby"><code><span class="n">pod</span> <span class="s1">'MapCache'</span>
</code></pre>
<h2 id='how-to-use-the-mapcache' class='heading'>How to use the MapCache?</h2>

<p>In the view controller where you have the <code>MKMapView</code> import <code><a href="Classes/MapCache.html">MapCache</a></code></p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">MapCache</span>
</code></pre>

<p>Then within the ViewController add</p>
<pre class="highlight swift"><code>
<span class="c1">// ViewController.swift</span>
<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
  <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">map</span><span class="p">:</span> <span class="kt">MKMapView</span><span class="o">!</span>

  <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

    <span class="o">...</span>

    <span class="n">map</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span>

    <span class="o">...</span>

    <span class="c1">// First setup the your cache</span>
    <span class="k">let</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">MapCacheConfig</span><span class="p">(</span><span class="nv">withTileUrlTemplate</span><span class="p">:</span> <span class="s">"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"</span><span class="p">)</span>

    <span class="c1">// initialize the cache with our config</span>
    <span class="n">mapCache</span> <span class="o">=</span> <span class="kt">MapCache</span><span class="p">(</span><span class="nv">withConfig</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>

    <span class="c1">// We tell the MKMapView to use our cache</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="nf">useCache</span><span class="p">(</span><span class="n">mapCache</span><span class="o">!</span><span class="p">)</span>

    <span class="o">...</span>
<span class="p">}</span>
</code></pre>

<p>Finally, tell the map delegate to use <code>mapCacheRenderer</code></p>
<pre class="highlight swift"><code><span class="c1">//ViewController.swift</span>

<span class="c1">// Assuming that ViewController is the delegate of the map</span>
<span class="c1">// add this extension:</span>
<span class="kd">extension</span> <span class="kt">ViewController</span> <span class="p">:</span> <span class="kt">MKMapViewDelegate</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">mapView</span><span class="p">(</span><span class="n">_</span> <span class="nv">mapView</span><span class="p">:</span> <span class="kt">MKMapView</span><span class="p">,</span> <span class="n">rendererFor</span> <span class="nv">overlay</span><span class="p">:</span> <span class="kt">MKOverlay</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">MKOverlayRenderer</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">mapView</span><span class="o">.</span><span class="nf">mapCacheRenderer</span><span class="p">(</span><span class="nv">forOverlay</span><span class="p">:</span> <span class="n">overlay</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>

<p>After setting up map cache browsed areas of the map will be kept on disk. If user browses again that area it will use the local version.
Note that in current version <code>0.1.0</code> cache has not expiration date so if you need to get a new version of the map you must call <code>clear()</code> which will wipe out the whole cache.</p>
<pre class="highlight swift"><code><span class="n">mapCache</span><span class="o">.</span><span class="nf">clear</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// do something after clear</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"cache cleared!"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>To get current cache size:</p>
<pre class="highlight swift"><code><span class="n">mapCache</span><span class="o">.</span><span class="nf">calculateSize</span><span class="p">()</span>
</code></pre>
<h2 id='mapcache-configuration' class='heading'>MapCache configuration</h2>

<p>Config map cache is pretty straight forward, typically you will need to set only <code>urlTemplate</code> and probably the <code>subdomains</code>. </p>

<p>These are the options:</p>
<pre class="highlight swift"><code><span class="k">var</span> <span class="nv">config</span> <span class="o">=</span> <span class="kt">MapCacheConfig</span><span class="p">()</span>

<span class="c1">// Set the URL template. </span>
<span class="c1">// For Open Street Maps you can chose: https://wiki.openstreetmap.org/wiki/Tile_servers</span>
<span class="c1">// It defaults to OpenStreetMaps servers </span>
<span class="c1">//</span>
<span class="c1">// Below we set cartoDB Base map server (https://github.com/CartoDB/cartodb/wiki/BaseMaps-available)</span>
<span class="n">config</span><span class="o">.</span><span class="nv">urlTemplate</span><span class="p">:</span> <span class="s">"https://${s}.basemaps.cartocdn.com/base-light/${z}/${x}/${y}.png"</span>


<span class="c1">// In the urlTemplate ${s} stands for subdomains, which allows you to balance </span>
<span class="c1">// the load among the</span>
<span class="c1">// different tile servers.</span>
<span class="c1">// Default value is ["a","b","c"].</span>
<span class="n">config</span><span class="o">.</span><span class="n">subdomains</span> <span class="o">=</span> <span class="p">[</span><span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">]</span> 


<span class="c1">// Cache Name is basically is the subfolder name in which the tiles are store.</span>
<span class="c1">// Default value is "MapCache"</span>
<span class="n">config</span><span class="o">.</span><span class="n">cacheName</span> <span class="o">=</span> <span class="s">"Carto"</span> 


<span class="c1">// Capacity of the cache in bytes. Once the cache is full it uses a LRU algorithm </span>
<span class="c1">// (Least Recently Used), that is, it removes the tiles last used a lot of time ago. </span>
<span class="c1">// Each time a tile is retrieved from the cache it is updated the value of last time used.</span>
<span class="c1">// Default value of the capacity is unlimited.</span>
<span class="n">config</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="c1">// 20 Megabytes</span>


</code></pre>

<p>If you need to use MapCache in different controllers, to avoid issues just be sure to use the same values in the config.</p>
<h2 id='you-may-also-like' class='heading'>You may also like</h2>

<ul>
<li><strong><a href="https://github.com/merlos/iOS-Open-GPX-Tracker">Open GPX Tracker</a></strong>. A free source iOS App to create <a href="https://en.wikipedia.org/wiki/GPS_Exchange_Format">GPX</a> tracks</li>
<li><strong><a href="https://github.com/vincentneo/CoreGPX">Core GPX</a></strong> A swift library for managing GPX files by <a href="https://github.com/vincentneo">Vincent Neo</a></li>
</ul>
<h2 id='license-mit' class='heading'>License - MIT</h2>

<p>Copyright &copy; 2019 Juan M. Merlos <a href="http://twitter.com/merlos">@merlos</a></p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the <q>Software</q>), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED <q>AS IS</q>, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2019 <a class="link" href="https://github.com/merlos/MapCache" target="_blank" rel="external">merlos</a>. All rights reserved. (Last updated: 2019-09-03)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.6</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
